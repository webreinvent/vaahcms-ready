<template>


    <tbody>

    <!--dynamic form creator-->
    <template v-for="column in columns" v-if="column.editable == true">

        <tr v-if="column.type == 'text'" :class="column.tr_class" >
            <th width="180" class="text-right">{{column.label}}</th>
            <td>
                <input type="text" class="form-control"
                       v-model="new_item[column.name]"
                       :name="column.name"
                       :disabled="column.disabled"
                       :placeholder="column.label" />
            </td>
        </tr>

        <tr v-else-if="column.type == 'password'" :class="column.tr_class">
            <th  class="text-right">{{column.label}}</th>
            <td>

                <input type="password" class="form-control"
                       v-model="new_item[column.name]"
                       :name="column.name"
                       :placeholder="column.label" />

            </td>
        </tr>

        <tr v-else-if="column.type == 'select'" :class="column.tr_class">
            <th  class="text-right">{{column.label}}</th>
            <td>

                <select class="custom-select" :placeholder="column.label" v-model="new_item[column.name]">
                    <option selected value="">Select {{column.label}}</option>
                    <option v-for="input in column.inputs" v-bind:value="input.slug">{{input.name}}</option>
                </select>

            </td>
        </tr>

        <tr v-else-if="column.type == 'select_with_ids'" :class="column.tr_class">
            <th  class="text-right">{{column.label}}</th>
            <td>

                <select class="custom-select" :placeholder="column.label"
                        v-model="new_item[column.name]">
                    <option selected value="">Select {{column.label}}</option>
                    <option v-for="input in column.inputs" v-bind:value="input.id">{{input.name}}</option>
                </select>

            </td>
        </tr>

        <tr v-else-if="column.type == 'date'" :class="column.tr_class">
            <th class="text-right">{{column.label}}</th>
            <td>

                <datepicker :placeholder="column.label" format="yyyy-MM-dd"
                            input-class="form-control"
                            v-model="new_item[column.name]" ></datepicker>

            </td>
        </tr>

    </template>

    </tbody>
    <!--/dynamic form creator-->

</template>

<script>

    //https://www.npmjs.com/package/vuejs-datepicker
    import Datepicker from 'vuejs-datepicker';

    export default {
        name: "TableFormGenerator",
        props: ['columns'],
        components:{
            'datepicker': Datepicker,
        },
        data()
        {
            let obj = {
                new_item: {
                    name: "",
                    title: "",
                    country: "",
                    status: "",
                    gender: "",
                    timezone: "",
                    country_calling_code: "",
                    invited_by: "",
                    user_id: "",
                }
            };

            return obj;
        },

        created() {
            this.mapValues();
        },
        watch: {
            'new_item': {
                handler: function () {

                    //TODO:: watch uninitialized params

                    this.emitItem();
                    this.$vaahcms.console("test");
                },
                deep: true
            }
        },
        methods: {
            //---------------------------------------------------------------------
            mapValues: function()
            {
                var self = this;
                var columns = this.columns;

                columns.map(function(item, key) {
                    if(item.value)
                    {
                        self.new_item[item.name] = item.value;
                    }
                });
            },
            //---------------------------------------------------------------------
            emitItem: function () {
                this.$root.$emit('eUpdateItem', this.new_item);
                this.$vaahcms.console('emit event');
            },
            //---------------------------------------------------------------------

            //---------------------------------------------------------------------
            //---------------------------------------------------------------------
            //---------------------------------------------------------------------
        },
    }
</script>

